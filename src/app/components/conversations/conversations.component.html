<div class="flex bg-secondary min-h-screen">
  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Main Container -->
  <div class="flex h-[95vh] container bg-secondary gap-4 my-auto mx-auto p-4">
    <!-- Inbox Sidebar -->
    <div class="w-64 bg-whites ring-1 ring-primary p-4 rounded-lg shadow-2xl space-y-6">
      <h3 class="text-primary font-semibold bg-accent text-center text-xl py-2 rounded-lg">
        Inbox
      </h3>

      <!-- Categories -->
      <ul class="space-y-2">
        <li
          *ngFor="let category of ['all', 'assigned']"
          (click)="changeCategory(category)"
          [class.bg-accent]="selectedCategory === category"
          class="cursor-pointer text-primary py-2 px-3 rounded-lg hover:bg-accent transition duration-200 ease-in-out"
        >
          {{ category | titlecase }}
          <span *ngIf="category === 'all'" class="ml-2 text-sm font-semibold text-gray-500">({{ messages.length }})</span>
        </li>
      </ul>

      <!-- Search -->
      <div class="mt-4">
        <input
          type="text"
          class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Search contacts..."
        />
      </div>

      <!-- Conversations List -->
      <ul class="space-y-3 overflow-y-auto overflow-x-hidden h-[40vh]">
        <li
          *ngFor="let message of messages"
          (click)="selectedChat = message"
          class="cursor-pointer p-3 bg-gray-100 hover:bg-gray-200 rounded-lg transition duration-200 ease-in-out"
        >
          <div class="flex justify-between items-center mb-1">
            <span class="text-primary font-semibold">{{ message.sender }}</span>
            <span class="text-xs text-gray-500">{{ message.time }}</span>
          </div>
          <p class="text-sm text-gray-600 truncate">{{ message.message }}</p>

          <!-- Status & Priority Indicators -->
          <div class="text-xs text-gray-500 mt-2">
            <span *ngIf="message.priority" class="text-red-500 font-semibold">Priority</span>
            <span *ngIf="message.status === 'open'" class="text-green-500 ml-2">Open</span>
            <span *ngIf="message.status === 'pending'" class="text-yellow-500 ml-2">Pending</span>
            <span *ngIf="message.status === 'closed'" class="text-gray-500 ml-2">Closed</span>
          </div>
        </li>
      </ul>
    </div>

    <!-- Chat Window -->
    <div class="flex flex-col flex-1 h-full bg-whites ring-1 ring-primary p-4 rounded-lg shadow-2xl">
      <!-- Chat Header -->
      <div class="flex items-center justify-between p-3 text-primary rounded-lg shadow-md bg-gray-100">
        <h2 class="font-semibold text-lg">
          {{ selectedChat?.sender || 'Select a Conversation' }}
          <!-- Priority and Status Indicators -->
          <span *ngIf="selectedChat?.priority" class="text-red-500 text-sm ml-2 font-semibold">Priority</span>
          <span *ngIf="selectedChat?.status === 'open'" class="text-green-500 text-sm ml-2">Open</span>
          <span *ngIf="selectedChat?.status === 'pending'" class="text-yellow-500 text-sm ml-2">Pending</span>
          <span *ngIf="selectedChat?.status === 'closed'" class="text-gray-500 text-sm ml-2">Closed</span>
        </h2>
        <div class="relative">
            <button title="button" (click)="toggleOptions()" class="bg-gray-200 text-primary py-2 px-4 rounded-lg hover:bg-gray-300 transition duration-200">
              <svg class="w-5 h-5" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                <path fill="var(--ci-primary-color, #000000)" d="M256,144a64,64,0,1,0-64-64A64.072,64.072,0,0,0,256,144Zm0-96a32,32,0,1,1-32,32A32.036,32.036,0,0,1,256,48Z" class="ci-primary"/>
                <path fill="var(--ci-primary-color, #000000)" d="M256,368a64,64,0,1,0,64,64A64.072,64.072,0,0,0,256,368Zm0,96a32,32,0,1,1,32-32A32.036,32.036,0,0,1,256,464Z" class="ci-primary"/>
                <path fill="var(--ci-primary-color, #000000)" d="M256,192a64,64,0,1,0,64,64A64.072,64.072,0,0,0,256,192Zm0,96a32,32,0,1,1,32-32A32.036,32.036,0,0,1,256,288Z" class="ci-primary"/>
              </svg>
            </button>
            <div *ngIf="showOptions" class="absolute right-0 mt-2 w-48 bg-white border rounded-lg shadow-lg">
            <ul class="py-1">
              <li (click)="addNotes()" class="px-4 py-2 hover:bg-gray-100 cursor-pointer">Add notes</li>
              <li (click)="viewTranscript()" class="px-4 py-2 hover:bg-gray-100 cursor-pointer">View transcript</li>
              <li (click)="deleteMessage()" class="px-4 py-2 hover:bg-gray-100 cursor-pointer">Delete message</li>
            </ul>
            </div>
        </div>
      </div>

     <!-- Chat Messages -->
<div class="flex-1 overflow-y-auto p-4 space-y-4">
  <div *ngIf="selectedChat" class="w-full">
    <div class="flex gap-2" [ngClass]="selectedChat.type === 'sent' ? 'justify-end' : 'justify-start'">
      <!-- Sent Message -->
      <div *ngIf="selectedChat.type === 'sent'" class="bg-accent text-white p-3 rounded-lg max-w-[75%] shadow-md">
        <p class="text-sm font-semibold">{{ selectedChat.message }}</p>
        <span class="text-xs text-gray-300 flex justify-end">{{ selectedChat.time }}</span>
        <span *ngIf="selectedChat.priority" class="text-xs text-red-500">Priority</span>
      </div>
      <!-- Received Message -->
      <div *ngIf="selectedChat.type === 'received'" class="bg-gray-300 text-black p-3 rounded-lg max-w-[75%] shadow-md">
        <p class="text-sm font-semibold">{{ selectedChat.message }}</p>
        <span class="text-xs text-gray-500">{{ selectedChat.time }}</span>
        <span *ngIf="selectedChat.priority" class="text-xs text-red-500">Priority</span>
        <span *ngIf="selectedChat.status === 'closed'" class="text-xs text-gray-500">Closed</span>
        <span *ngIf="selectedChat.status === 'pending'" class="text-xs text-yellow-500">Pending</span>
        <span *ngIf="selectedChat.status === 'open'" class="text-xs text-green-500">Open</span>
      </div>
    </div>
  </div>
</div>


      <!-- Message Input -->
      <div class="flex items-center gap-2 border-t pt-4">
        <input
          type="text"
          [(ngModel)]="newMessage"
          class="flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Type a message..."
        />
        <button
          (click)="sendMessage()"
          class="bg-accent text-white py-2 px-4 rounded-lg hover:bg-primary transition duration-200"
        >
          Send
        </button>
      </div>
    </div>
  </div>
</div>
